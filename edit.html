<!DOCTYPE html><html lang="ar"><head>  <meta charset="UTF-8">  <title>✏️ تعديل الكوميكس</title>  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">  <style>    :root {      --bg: #f4f4f4;      --card: #fff;      --border: #ccc;      --text: #222;    }    @media (prefers-color-scheme: dark) {      :root {        --bg: #121212;        --card: #1e1e1e;        --border: #333;        --text: #eee;      }    }    body {      font-family: 'Cairo', sans-serif;      background-color: var(--bg);      color: var(--text);      margin: 0;      padding: 20px;      direction: rtl;    }    h2 {      text-align: center;      color: #1a73e8;    }    form {      background: var(--card);      padding: 25px;      max-width: 750px;      margin: auto;      border-radius: 12px;      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);    }    input, textarea, button {      width: 100%;      padding: 12px;      margin: 10px 0;      font-size: 16px;      border-radius: 6px;      border: 1px solid var(--border);      background: inherit;      color: inherit;    }    textarea {      resize: vertical;      min-height: 100px;    }    button {      background-color: #1a73e8;      color: white;      font-weight: bold;      border: none;      cursor: pointer;    }    button:hover {      background-color: #0f5bd6;    }    .images-container {      display: flex;      flex-wrap: wrap;      gap: 10px;      justify-content: center;    }    .image-item {      position: relative;      width: 100px;      cursor: grab;    }    .image-item img {      width: 100%;      border-radius: 6px;    }    .remove-btn {      position: absolute;      top: -5px;      left: -5px;      background: red;      color: white;      font-size: 14px;      border-radius: 50%;      width: 20px;      height: 20px;      cursor: pointer;    }    .copy-btn {      position: absolute;      bottom: -5px;      left: 0;      background: #1a73e8;      color: white;      font-size: 12px;      border-radius: 4px;      padding: 2px 4px;      cursor: pointer;    }    .drop-zone {      border: 2px dashed var(--border);      padding: 20px;      border-radius: 10px;      text-align: center;      color: #999;      margin-top: 15px;    }    .drop-zone.dragover {      background-color: #e0f7ff;    }    a.back-link {      display: inline-block;      margin-top: 20px;      text-decoration: none;      color: #1a73e8;      font-weight: bold;    }    #saveStatus {      text-align: center;      color: green;      display: none;      font-weight: bold;    }  </style></head><body><h2>✏️ تعديل الكوميكس</h2><form id="editForm">  <input type="text" id="title" placeholder="عنوان الكوميك" required>  <textarea id="desc" placeholder="وصف الكوميك"></textarea>  <input type="text" id="category" placeholder="التصنيف">  <h3>📸 الصور الحالية <span id="imageCount"></span></h3>  <div class="images-container" id="imagesContainer"></div>  <input type="url" id="newImage" placeholder="رابط صورة جديدة">  <button type="button" onclick="addImage()">➕ أضف صورة من رابط</button>  <input type="file" id="uploadImage" accept="image/*" multiple>  <div class="drop-zone" id="dropZone">📥 اسحب وأفلت صورة أو رابط هنا</div>  <button type="button" onclick="undoImageChange()">↩️ تراجع الصور</button>  <button type="submit">💾 حفظ التعديلات</button>  <p id="saveStatus">✔️ تم الحفظ تلقائيًا</p>  <a href="index.html" class="back-link">🔙 العودة للمكتبة</a></form><script>  const index = parseInt(localStorage.getItem("editIndex"), 10);  const comics = JSON.parse(localStorage.getItem("comics")) || [];  if (isNaN(index) || !comics[index]) {    alert("❌ لم يتم العثور على الكوميكس المطلوب تعديله.");    window.location.href = "index.html";  }  const comic = comics[index];  const imagesContainer = document.getElementById("imagesContainer");  const dropZone = document.getElementById("dropZone");  document.getElementById("title").value = comic.title || "";  document.getElementById("desc").value = comic.desc || "";  document.getElementById("category").value = comic.category || "";  let images = comic.images || (comic.image ? [comic.image] : []);  let imageHistory = [];  function renderImages() {    imagesContainer.innerHTML = "";    images.forEach((src, i) => {      const div = document.createElement("div");      div.className = "image-item";      div.innerHTML = `        <img src="${src}" alt="صورة ${i + 1}" onclick="window.open('${src}', '_blank')">        <button class="remove-btn" onclick="removeImage(${i})">×</button>        <div class="copy-btn" onclick="copyImageURL('${src}')">📋</div>      `;      imagesContainer.appendChild(div);    });    document.getElementById("imageCount").textContent = `(${images.length})`;  }  function pushToHistory() {    imageHistory.push([...images]);    if (imageHistory.length > 10) imageHistory.shift();  }  function undoImageChange() {    if (imageHistory.length > 0) {      images = imageHistory.pop();      renderImages();      autoSave();    }  }  function copyImageURL(url) {    navigator.clipboard.writeText(url).then(() => alert("📋 تم نسخ الرابط!"));  }  function removeImage(i) {    pushToHistory();    images.splice(i, 1);    renderImages();    autoSave();  }  function addImage() {    const url = document.getElementById("newImage").value.trim();    if (url && !images.includes(url)) {      pushToHistory();      images.push(url);      renderImages();      document.getElementById("newImage").value = "";      autoSave();    }  }  document.getElementById("uploadImage").addEventListener("change", (e) => {    pushToHistory();    Array.from(e.target.files).forEach(file => {      const reader = new FileReader();      reader.onload = () => {        images.push(reader.result);        renderImages();        autoSave();      };      reader.readAsDataURL(file);    });  });  dropZone.addEventListener("dragover", (e) => {    e.preventDefault();    dropZone.classList.add("dragover");  });  dropZone.addEventListener("dragleave", () => {    dropZone.classList.remove("dragover");  });  dropZone.addEventListener("drop", (e) => {    e.preventDefault();    dropZone.classList.remove("dragover");    const files = e.dataTransfer.files;    if (files.length) {      pushToHistory();      Array.from(files).forEach(file => {        if (file.type.startsWith("image/")) {          const reader = new FileReader();          reader.onload = () => {            images.push(reader.result);            renderImages();            autoSave();          };          reader.readAsDataURL(file);        }      });    } else {      const url = e.dataTransfer.getData("text/plain").trim();      if (url && url.startsWith("http")) {        pushToHistory();        images.push(url);        renderImages();        autoSave();      } else {        alert("⚠️ فقط روابط أو صور يمكن إفلاتها هنا.");      }    }  });  new Sortable(imagesContainer, {    animation: 150,    onEnd: () => {      const newImages = [];      imagesContainer.querySelectorAll("img").forEach(img => newImages.push(img.src));      pushToHistory();      images = newImages;      autoSave();    }  });  let autoSaveTimeout;  function autoSave() {    clearTimeout(autoSaveTimeout);    autoSaveTimeout = setTimeout(() => {      comic.title = document.getElementById("title").value.trim();      comic.desc = document.getElementById("desc").value.trim();      comic.category = document.getElementById("category").value.trim();      comic.images = [...images];      delete comic.image;      comics[index] = { ...comic };      localStorage.setItem("comics", JSON.stringify(comics));      const status = document.getElementById("saveStatus");      status.style.display = "block";      setTimeout(() => status.style.display = "none", 1500);    }, 1500);  }  ["title", "desc", "category"].forEach(id => {    const el = document.getElementById(id);    if (el) el.addEventListener("input", autoSave);  });  renderImages();  document.getElementById("editForm").addEventListener("submit", function(e) {    e.preventDefault();    autoSave();    alert("✅ تم حفظ التعديلات!");    window.location.href = "index.html";  });  let formChanged = false;  document.querySelectorAll("#editForm input, #editForm textarea").forEach(input => {    input.addEventListener("input", () => formChanged = true);  });  window.addEventListener("beforeunload", (e) => {    if (formChanged) {      e.preventDefault();      e.returnValue = "";    }  });</script></body></html>